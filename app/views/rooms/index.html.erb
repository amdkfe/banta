
<div class="grid-container">
  <div id="roomList">
    <ul class="rooms">
    </ul>
  </div>

  <div id="messageView">
    <ul class="m">
    </ul>
  </div>

  <div id="newMessage">
  </div>
</div>


<script>

//room list section
class RoomList{
  constructor(sel){
    this.el = document.querySelector(sel);
    this.getRooms(this.render.bind(this));
  }
  getRooms(cb){
    fetch('/rooms.json', {credentials: 'include'})
      .then(function(response) {
        return response.json();
      })
      .then(function(json) {
        cb(json)
      });
  }
  render(list){
    var roomList = this.el.querySelector('.rooms');
    for(let i=0; i<list.length; i++){
      var li = document.createElement('li');
      var link = document.createElement('a');
      link.innerHTML = list[i].name;
      li.appendChild(link);
      roomList.appendChild(li);
      li.addEventListener('click', () => {
        this.onRoomSelected(list[i].id);
      });
    }
  }
}


//message content
class MessageList {
  constructor(sel, room_id) {
    this.messageview = document.querySelector(sel);
    this.room_id = room_id;
    this.getMessages(this.render.bind(this));
  }
  getMessages(cb){
  fetch('/rooms/' + this.room_id + '/messages.json', {credentials: 'include'})
    .then(function(response) {
      return response.json();
    })
    .then(function(json) {
      cb(json)
    });
  }
  render(list){
    var mList = this.messageview.querySelector('.m');
    mList.innerHTML = '';
    for(let i=0; i<list.length; i++){
      var link = document.createElement('p');
      link.innerHTML = list[i].content;
      mList.appendChild(link);
    }
  }
}


var roomList = new RoomList('#roomList');

roomList.onRoomSelected = function(id){
  var messagebox = new MessageList('#messageView', id);
};


</script>

